#+TITLE: Programming Configuration
#+PROPERTY: header-args:emacs-lisp :tangle programming-config.el :mkdirp yes
#+STARTUP: overview

* Header
#+begin_src emacs-lisp
;;; programming-config.el --- Programming tools -*- lexical-binding: t -*-
;;; Commentary:
;; LSP, syntax checking, Git, and project management
;;; Code:
#+end_src

* Syntax Checking

#+begin_src emacs-lisp
(use-package flycheck
  :init (global-flycheck-mode))
#+end_src

* Version Control

** Magit
#+begin_src emacs-lisp
(use-package magit
  :bind ("C-x g" . magit))
#+end_src

** SQLite (for Forge)
#+begin_src emacs-lisp
(use-package sqlite3)
#+end_src

** Forge
#+begin_src emacs-lisp
(use-package forge
  :after magit)
#+end_src

* Project Management

** Projectile
#+begin_src emacs-lisp
(use-package projectile
  :init
  (projectile-mode 1))
#+end_src

** FZF
#+begin_src emacs-lisp
(use-package fzf
  :config
  (setq fzf/args "-x --color bw --print-query --margin=1,0 --no-hscroll"
        fzf/executable "fzf"
        fzf/git-grep-args "-i --line-number %s"
        fzf/grep-command "grep -nrH"
        fzf/position-bottom t
        fzf/window-height 15))
#+end_src

** Ripgrep
#+begin_src emacs-lisp
(use-package rg
  :if (executable-find "rg"))
#+end_src

* LSP

** Eglot
#+begin_src emacs-lisp
(use-package eglot
  :defer t
  :hook ((go-mode . eglot-ensure)
         (python-mode . eglot-ensure)
         (rust-mode . eglot-ensure)))
#+end_src

* Tree-sitter

#+begin_src emacs-lisp
(use-package tree-sitter
  :hook ((python-mode . tree-sitter-mode)
         (python-mode . tree-sitter-hl-mode)
         (go-mode . tree-sitter-mode)
         (go-mode . tree-sitter-hl-mode)
         (rust-mode . tree-sitter-mode)
         (rust-mode . tree-sitter-hl-mode)))

(use-package tree-sitter-langs
  :after tree-sitter)
#+end_src

* Go / Company

#+begin_src emacs-lisp
(use-package company
  :ensure t
  :defer t
  :init
  ;; general company settings
  (setq company-idle-delay 0.2
        company-minimum-prefix-length 1)
  :config
  ;; Prefer LSP/EGLOT completion (capf) in Go buffers
  (add-hook 'go-mode-hook
            (lambda ()
              (company-mode 1)
              (setq-local company-backends '(company-capf))
              ;; If `corfu' is enabled globally, disable it in go-mode to avoid UI conflicts
              (when (fboundp 'corfu-mode)
                (corfu-mode -1)))))
#+end_src

* Environment

#+begin_src emacs-lisp
(use-package exec-path-from-shell
  :config
  (when (memq window-system '(mac ns x))
    (exec-path-from-shell-initialize)))
#+end_src

#+begin_src emacs-lisp
;; Ensure Go bins are in Emacs `exec-path` (user and system locations)
(let ((gobin (expand-file-name "~/go/bin"))
      (sysgobin "/usr/local/go/bin"))
  (dolist (dir (list gobin sysgobin))
    (when (and (file-directory-p dir)
               (not (member dir exec-path)))
      (add-to-list 'exec-path dir)
      (setenv "PATH" (concat dir ":" (getenv "PATH"))))))

;; Prefer `gopls` for Go via Eglot if available.
(with-eval-after-load 'eglot
  (add-to-list 'eglot-server-programs '(go-mode . ("gopls"))))
#+end_src

* Footer
#+begin_src emacs-lisp
(provide 'programming-config)
;;; programming-config.el ends here
#+end_src
